<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!-- - Application context with IPP services for a Infinity Process Engine client. -->
<beans>
   <import resource="classpath:carnot-spring-jta-jencks-context.xml" />

   <bean id="carnotXaAuditTrailDataSource" class="org.apache.derby.jdbc.EmbeddedXADataSource">
      <property name="databaseName" value="target/ipp-test-DB" />
      <property name="user" value="carnot" />
      <property name="password" value="ag" />
      <property name="createDatabase" value="create" />
   </bean>

   <bean id="carnotWorkflowService" parent="abstractPublicCarnotService"
      class="org.eclipse.stardust.engine.api.spring.WorkflowServiceBean" />

   <bean id="carnotUserService" parent="abstractPublicCarnotService"
      class="org.eclipse.stardust.engine.api.spring.UserServiceBean" />

   <bean id="carnotQueryService" parent="abstractPublicCarnotService"
      class="org.eclipse.stardust.engine.api.spring.QueryServiceBean" />

   <bean id="carnotAdministrationService" parent="abstractPublicCarnotService"
      class="org.eclipse.stardust.engine.api.spring.AdministrationServiceBean" />

   <bean id="carnotDocumentManagementService" parent="abstractPublicCarnotService"
      class="org.eclipse.stardust.engine.api.spring.DocumentManagementServiceBean" />

   <bean abstract="true" id="abstractCarnotService"
      class="org.eclipse.stardust.engine.api.spring.AbstractSpringServiceBean">
      <property name="carnotProperties" ref="customCarnotProperties" />
      <property name="transactionManager" ref="carnotTxManager" />
      <property name="dataSource" ref="xaAuditTrailConnectionFactory" />
      <property name="jcaResourceProvider" ref="carnotJcaResourceResolver" />
      <!-- <property name="jmsResourceProvider" ref="carnotJmsResourceResolver" /> -->
   </bean>

   <bean name="carnotJcaResourceResolver"
      class="org.eclipse.stardust.engine.spring.integration.jca.DefaultJcaResourceResolver" />

<!--    <bean name="carnotJmsResourceResolver"
      class="org.eclipse.stardust.engine.spring.integration.jms.DefaultJmsResourceResolver" /> -->

   <bean abstract="true" name="abstractPublicCarnotService" parent="abstractCarnotService">
      <!--property name="principalProvider" ref="whatever" / -->
   </bean>

   <bean id="localForkingService" parent="abstractCarnotService"
      class="org.eclipse.stardust.engine.api.spring.QueuedSpringForkingService">
      <property name="jobManager" ref="carnotAsyncJobManager" />
   </bean>

   <!-- Replace jmsForkingService by 'localForkingService' in a non-jms environment. Using 
      a jms environment it should be replaced by 'jmsForkingService'. -->
   <alias name="localForkingService" alias="carnotForkingService" />

   <bean id="carnotAsyncJobManager" class="org.eclipse.stardust.engine.spring.threading.FiFoJobManager"
      singleton="true">
      <property name="maxParallelJobs" value="10" />
      <property name="useShutdownHook" value="true" />
   </bean>

   <!-- Can be used to override settings from carnot.properties -->
   <bean id="customCarnotProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
      <property name="properties">
         <props>
            <!-- <prop key="AuditTrail.Type">DERBY</prop> -->
         </props>
      </property>
   </bean>
</beans>
