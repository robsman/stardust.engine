<!--
    Copyright (c) 2011 SunGard CSA LLC and others.
    All rights reserved. This program and the accompanying materials
    are made available under the terms of the Eclipse Public License v1.0
    which accompanies this distribution, and is available at
    http://www.eclipse.org/legal/epl-v10.html

    Contributors:
       SunGard CSA LLC - initial API and implementation and/or initial documentation
 -->

<!--
  To execute this build script, you have to configure your environment as follows:
  - Java property java.home must point to an existent JAVA_HOME (either via parameter
    (e.g. antit.bat -Djava.home=C:/Programme/Java15) or create a private.properties file
    in the etc folder of the project and put the property in there)
-->

<project name="carnot-engine" default="deploy" basedir="." xmlns:ipp="com.infinity.bpm.ant.macros">

   <import file="../../../buildtools/build-commons.xml" />

   <property name="project.dir" location="${basedir}" />
   <property name="project.etc" value="${project.dir}/etc" />
   <property name="project.src" location="${project.dir}/src/main/java" />
   <property name="project.res" location="${project.dir}/src/main/resources" />
   <property name="project.test" location="${project.dir}/src/test" />
   <property name="project.test.src" location="${project.test}/java" />
   <property name="project.test.res" location="${project.test}/resources" />

   <property file="${project.etc}/private.properties" />

   <property name="build.dir" value="build" />

   <property name="service.dir" location="${project.src}/ag/carnot/workflow/ejb" />
   <property name="serviceTemp.dir" location="${build.dir}/temp/ag/carnot/workflow/ejb" />

   <property name="moonglow.dir" location="../../../moonglow" />
   <available property="moonglow.dir.present" file="${moonglow.dir}" type="dir" />

   <target name="jar" depends="compile, checkCodeGen, init.jarjar">
      <ipp:jar jarfile="${carnot.base.jar}" implementationTitle="Infinity Process Engine - Base">

         <fileset dir="${build.classes}" id="fileset.carnot.base.jar">

            <include name="META-INF/services/org.eclipse.stardust.common.config.*" />

            <include name="ag/carnot/autolist/**/*.class" />
            <include name="org/eclipse/stardust/common/**/*.class" />
            <include name="org/eclipse/stardust/common/config/**/*.class" />
            <include name="org/eclipse/stardust/common/error/**/*.class" />
            <include name="org/eclipse/stardust/common/reflect/**/*.class" />
            <include name="org/eclipse/stardust/common/security/**/*.class" />
            <include name="org/eclipse/stardust/common/utils/console/**/*.class" />
            <include name="org/eclipse/stardust/common/utils/ejb/*.class" />
            <include name="org/eclipse/stardust/common/utils/rt/*.class" />
            <include name="org/eclipse/stardust/common/utils/xml/**/*.class" />
            <!-- excluding due to questionable dependencies -->
            <exclude name="org/eclipse/stardust/common/security/authentication/GUICallbackHandler*.class" />
            <exclude name="org/eclipse/stardust/common/security/authentication/LoginDialog*.class" />
         </fileset>
         <fileset dir="${project.res}">
            <include name="about.html" />
            <include name="about_files/*" />
         </fileset>
      </ipp:jar>

      <ipp:jarjar jarfile="${carnot.client.jar}" implementationTitle="Infinity Process Engine - Client">

         <rule pattern="org.eclipse.emf.**" result="com.infinity.bpm.thirdparty.emf.@1" />
         <rule pattern="org.eclipse.xsd.**" result="com.infinity.bpm.thirdparty.xsd.@1" />
         <rule pattern="org.mozilla.**" result="com.infinity.bpm.thirdparty.org.mozilla.@1" />
         <rule pattern="**.emfxsd.**" result="@1.emfxsd.runtime.@2" />

         <zipfileset src="${emf-common.jar}"
            excludes="about.html, about.ini, about.mappings, about.properties, modeling32.png, plugin.properties, plugin.xml, META-INF/**/*"/>
         <zipfileset src="${emf-ecore.jar}"
            excludes="about.html, about.ini, about.mappings, about.properties, modeling32.png, plugin.properties, plugin.xml, META-INF/**/*, model/**/*, schema/**/*, org/eclipse/emf/ecore/doc-files/**/*, org/eclipse/emf/ecore/resource/doc-files/**/*" />
         <zipfileset src="${emf-ecore-xmi.jar}"
            excludes="about.html, plugin.properties, plugin.xml, META-INF/**/*" />
         <zipfileset src="${emf-xsd.jar}"
            excludes="about.html, about.ini, about.mappings, about.properties, modeling32.png, plugin.properties, plugin.xml, META-INF/**/*, model/**/*, cache/**/*, org/eclipse/xsd/doc-files/**/*" />
         <zipfileset src="${emf-xsd.jar}" includes="plugin.properties" prefix="com/infinity/bpm/thirdparty/xsd" />
         <zipfileset src="${emf-xsd-schema-cache.jar}" />

         <zipfileset src="${js.jar}" />

         <fileset dir="${build.classes}" id="fileset.carnot.client.jar">

            <include name="META-INF/resources/models/**" />
            <include name="META-INF/services/org.eclipse.stardust.*" />
            <include name="META-INF/services/com.*" />
            <include name="META-INF/services/ag.*" />

            <include name="org/eclipse/stardust/**" />
            <include name="ag/**" />
            <include name="com/infinity/**" />
         </fileset>
         <fileset dir="${project.res}">
            <include name="about.html" />
            <include name="about_files/*" />
            <include name="com/infinity/bpm/rt/impl/**/*.xml" />
            <include name="com/infinity/bpm/rt/integration/data/dms/*.xsd" />
         </fileset>
      </ipp:jarjar>

      <ipp:jar jarfile="${carnot.emf.xsd.integration.jar}" implementationTitle="CARNOT EMF XSD Integration">
         <fileset dir="${build.classes}" id="fileset.carnot.spring.jar">
            <include name="**/emfxsd/*.class" />
         </fileset>
      </ipp:jar>

      <ipp:jarjar jarfile="${carnot.engine.jar}" implementationTitle="Infinity Process Engine - Runtime">

         <rule pattern="org.eclipse.emf.**" result="com.infinity.bpm.thirdparty.emf.@1" />
         <rule pattern="org.eclipse.xsd.**" result="com.infinity.bpm.thirdparty.xsd.@1" />
         <rule pattern="org.mozilla.**" result="com.infinity.bpm.thirdparty.org.mozilla.@1" />

         <rule pattern="**.emfxsd.**" result="@1.emfxsd.runtime.@2" />

         <zipfileset src="${emf-common.jar}"
            excludes="about.html, about.ini, about.mappings, about.properties, modeling32.png, plugin.properties, plugin.xml, META-INF/**/*" />
         <zipfileset src="${emf-ecore.jar}"
            excludes="about.html, about.ini, about.mappings, about.properties, modeling32.png, plugin.properties, plugin.xml, META-INF/**/*, model/**/*, schema/**/*, org/eclipse/emf/ecore/doc-files/**/*, org/eclipse/emf/ecore/resource/doc-files/**/*" />
         <zipfileset src="${emf-ecore-xmi.jar}"
            excludes="about.html, plugin.properties, plugin.xml, META-INF/**/*" />
         <zipfileset src="${emf-xsd.jar}"
            excludes="about.html, about.ini, about.mappings, about.properties, modeling32.png, plugin.properties, plugin.xml, META-INF/**/*, model/**/*, cache/**/*, org/eclipse/xsd/doc-files/**/*" />
         <zipfileset src="${emf-xsd.jar}" includes="plugin.properties" prefix="com/infinity/bpm/thirdparty/xsd" />
         <zipfileset src="${emf-xsd-schema-cache.jar}" />

         <zipfileset src="${js.jar}" />

         <fileset dir="${build.classes}" id="fileset.carnot.engine.jar">

            <include name="META-INF/resources/models/**" />
            <include name="META-INF/services/org.eclipse.stardust.*" />
            <include name="META-INF/services/com.*" />
            <include name="META-INF/services/ag.*" />

            <include name="org/eclipse/stardust/**" />
            <include name="ag/**" />
            <include name="com/infinity/**" />
         </fileset>
         <fileset dir="${project.res}">
            <include name="about.html" />
            <include name="about_files/*" />
            <include name="com/infinity/bpm/rt/impl/**/*.xml" />
            <include name="com/infinity/bpm/rt/integration/data/dms/*.xsd" />
         </fileset>
      </ipp:jarjar>

      <ipp:jar jarfile="${carnot.dms.jar}" implementationTitle="Infinity Process Engine - DMS Integration">
         <fileset dir="${build.classes}" id="fileset.carnot.dms.jar">
            <include name="ag/carnot/bpm/integration/dms/**/*.class" />
            <include name="ag/carnot/bpm/rt/integration/dms/**/*.class" />
         </fileset>
      </ipp:jar>
      <ipp:jar jarfile="${carnot.public.jar}" implementationTitle="Infinity Process Engine - Public">
         <fileset dir="${build.classes}" id="fileset.carnot.public.jar">
            <include name="org/eclipse/stardust/common/DateUtils.class" />
            <include name="org/eclipse/stardust/common/Direction.class" />
            <include name="org/eclipse/stardust/common/Flushable.class" />
            <include name="org/eclipse/stardust/common/IntKey.class" />
            <!-- todo: rework that class before including again to javadoc -->
            <!--include name="org/eclipse/stardust/common/Money.class"/-->
            <include name="org/eclipse/stardust/common/Pair.class" />
            <include name="org/eclipse/stardust/common/Period.class" />
            <include name="org/eclipse/stardust/common/StringKey.class" />
            <include name="org/eclipse/stardust/common/log/Category.class" />
            <include name="org/eclipse/stardust/common/log/LogManager.class" />
            <include name="org/eclipse/stardust/common/log/Logger.class" />
            <include name="ag/carnot/db/Operator.class" />
            <include name="org/eclipse/stardust/common/error/AccessForbiddenException.class" />
            <include name="org/eclipse/stardust/common/error/ApplicationException.class" />
            <include name="org/eclipse/stardust/common/error/ConcurrencyException.class" />
            <include name="org/eclipse/stardust/common/error/ErrorCase.class" />
            <include name="org/eclipse/stardust/common/error/InternalException.class" />
            <include name="org/eclipse/stardust/common/error/InvalidArgumentException.class" />
            <include name="org/eclipse/stardust/common/error/InvalidValueException.class" />
            <include name="org/eclipse/stardust/common/error/ObjectNotFoundException.class" />
            <include name="org/eclipse/stardust/common/error/PublicException.class" />

            <include name="org/eclipse/stardust/common/security/InvalidPasswordException.class" />
            <include name="org/eclipse/stardust/common/security/authentication/ConsoleCallbackHandler.class" />
            <include name="org/eclipse/stardust/common/security/authentication/ConsolePrompt.class" />
            <include name="org/eclipse/stardust/common/security/authentication/DefaultCallbackHandler.class" />
            <include name="org/eclipse/stardust/common/security/authentication/GUICallbackHandler.class" />
            <include name="org/eclipse/stardust/common/security/authentication/LoginDialog.class" />
            <include name="org/eclipse/stardust/common/security/authentication/LoginFailedException.class" />

            <include name="ag/carnot/web/ServiceFactoryLocator.class" />

            <include name="ag/carnot/workflow/ejb/EjbEnvServiceFactory.class" />
            <include name="ag/carnot/workflow/ejb/ServiceFactoryLocator.class" />
            <include name="ag/carnot/workflow/ejb/WorkflowException.class" />
            <include name="ag/carnot/workflow/ejb/RemoteAdministrationService.class" />
            <include name="ag/carnot/workflow/ejb/RemoteAdministrationServiceHome.class" />
            <include name="ag/carnot/workflow/ejb/RemoteWorkflowService.class" />
            <include name="ag/carnot/workflow/ejb/RemoteWorkflowServiceHome.class" />
            <include name="ag/carnot/workflow/ejb/RemoteDocumentManagementService.class" />
            <include name="ag/carnot/workflow/ejb/RemoteDocumentManagementServiceHome.class" />
            <include name="ag/carnot/workflow/ejb/RemoteQueryService.class" />
            <include name="ag/carnot/workflow/ejb/RemoteQueryServiceHome.class" />
            <include name="ag/carnot/workflow/ejb/RemoteUserService.class" />
            <include name="ag/carnot/workflow/ejb/RemoteUserServiceHome.class" />

            <include name="ag/carnot/workflow/ejb/LocalAdministrationService.class" />
            <include name="ag/carnot/workflow/ejb/LocalAdministrationServiceHome.class" />
            <include name="ag/carnot/workflow/ejb/LocalWorkflowService.class" />
            <include name="ag/carnot/workflow/ejb/LocalWorkflowServiceHome.class" />
            <include name="ag/carnot/workflow/ejb/LocalDocumentManagementService.class" />
            <include name="ag/carnot/workflow/ejb/LocalDocumentManagementServiceHome.class" />
            <include name="ag/carnot/workflow/ejb/LocalQueryService.class" />
            <include name="ag/carnot/workflow/ejb/LocalQueryServiceHome.class" />
            <include name="ag/carnot/workflow/ejb/LocalUserService.class" />
            <include name="ag/carnot/workflow/ejb/LocalUserServiceHome.class" />

            <include name="ag/carnot/workflow/model/AccessPoint.class" />
            <include name="ag/carnot/workflow/model/Activity.class" />
            <include name="ag/carnot/workflow/model/ApplicationContext.class" />
            <include name="ag/carnot/workflow/model/Application.class" />
            <include name="ag/carnot/workflow/model/ConditionalPerformer.class" />
            <include name="ag/carnot/workflow/model/ConditionalPerformerInfo.class" />
            <include name="ag/carnot/workflow/model/ContextData.class" />
            <include name="ag/carnot/workflow/model/Data.class" />
            <include name="ag/carnot/workflow/model/DataMapping.class" />
            <include name="ag/carnot/workflow/model/DataPath.class" />
            <include name="ag/carnot/workflow/model/DynamicParticipant.class" />
            <include name="ag/carnot/workflow/model/DynamicParticipantInfo.class" />
            <include name="ag/carnot/workflow/model/EventAction.class" />
            <include name="ag/carnot/workflow/model/EventAware.class" />
            <include name="ag/carnot/workflow/model/EventHandler.class" />
            <include name="ag/carnot/workflow/model/FormalParameter.class" />
            <include name="ag/carnot/workflow/model/ImplementationType.class" />
            <include name="ag/carnot/workflow/model/Inconsistency.class" />
            <include name="ag/carnot/workflow/model/Model.class" />
            <include name="ag/carnot/workflow/model/ModelElement.class" />
            <include name="ag/carnot/workflow/model/ModelParticipant.class" />
            <include name="ag/carnot/workflow/model/ModelParticipantInfo.class" />
            <include name="ag/carnot/workflow/model/Organization.class" />
            <include name="ag/carnot/workflow/model/OrganizationInfo.class" />
            <include name="ag/carnot/workflow/model/ParameterMapping.class" />
            <include name="ag/carnot/workflow/model/Participant.class" />
            <include name="ag/carnot/workflow/model/ParticipantInfo.class" />
            <include name="ag/carnot/workflow/model/ParticipantType.class" />
            <include name="ag/carnot/workflow/model/PredefinedConstants.class" />
            <include name="ag/carnot/workflow/model/ProcessDefinition.class" />
            <include name="ag/carnot/workflow/model/ProcessInterface.class" />
            <include name="ag/carnot/workflow/model/ProfileScope.class" />
            <include name="ag/carnot/workflow/model/Role.class" />
            <include name="ag/carnot/workflow/model/RoleInfo.class" />
            <include name="ag/carnot/workflow/model/SubProcessModeKey.class" />
            <include name="ag/carnot/workflow/model/Trigger.class" />
            <include name="ag/carnot/workflow/model/TypeDeclaration.class" />
            <include name="ag/carnot/workflow/model/XpdlType.class" />

            <include name="ag/carnot/workflow/runtime/AcknowledgementState.class" />
            <include name="ag/carnot/workflow/runtime/ActivityCompletionLog.class" />
            <include name="ag/carnot/workflow/runtime/ActivityInstance.class" />
            <include name="ag/carnot/workflow/runtime/ActivityInstanceState.class" />
            <include name="ag/carnot/workflow/runtime/AdministrationService.class" />
            <include name="ag/carnot/workflow/runtime/AuditTrailHealthReport.class" />
            <include name="ag/carnot/workflow/runtime/BindingException.class" />
            <include name="ag/carnot/workflow/runtime/Daemon.class" />
            <include name="ag/carnot/workflow/runtime/DaemonExecutionState.class" />
            <include name="ag/carnot/workflow/runtime/Department.class" />
            <include name="ag/carnot/workflow/runtime/DepartmentExistsException.class" />
            <include name="ag/carnot/workflow/runtime/DepartmentInfo.class" />
            <include name="ag/carnot/workflow/runtime/DeployedModel.class" />
            <include name="ag/carnot/workflow/runtime/DeployedModelDescription.class" />
            <include name="ag/carnot/workflow/runtime/DeploymentElement.class" />
            <include name="ag/carnot/workflow/runtime/DeploymentException.class" />
            <include name="ag/carnot/workflow/runtime/DeploymentInfo.class" />
            <include name="ag/carnot/workflow/runtime/DeploymentOptions.class" />
            <include name="ag/carnot/workflow/runtime/Document.class" />
            <include name="ag/carnot/workflow/runtime/Documents.class" />
            <include name="ag/carnot/workflow/runtime/DocumentManagementService.class" />
            <include name="ag/carnot/workflow/runtime/EventActionBinding.class" />
            <include name="ag/carnot/workflow/runtime/EventHandlerBinding.class" />
            <include name="ag/carnot/workflow/runtime/Grant.class" />
            <include name="ag/carnot/workflow/runtime/HistoricalEvent.class" />
            <include name="ag/carnot/workflow/runtime/HistoricalEventDescription.class" />
            <include name="ag/carnot/workflow/runtime/HistoricalEventDescriptionDelegation.class" />
            <include name="ag/carnot/workflow/runtime/HistoricalEventDescriptionStateChange.class" />
            <include name="ag/carnot/workflow/runtime/HistoricalEventType.class" />
            <include name="ag/carnot/workflow/runtime/IllegalOperationException.class" />
            <include name="ag/carnot/workflow/runtime/IllegalStateChangeException.class" />
            <include name="ag/carnot/workflow/runtime/ImplementationDescription.class" />
            <include name="ag/carnot/workflow/runtime/LogCode.class" />
            <include name="ag/carnot/workflow/runtime/LogEntry.class" />
            <include name="ag/carnot/workflow/runtime/LogType.class" />
            <include name="ag/carnot/workflow/runtime/Mail.class" />
            <include name="ag/carnot/workflow/runtime/ModelReconfigurationInfo.class" />
            <include name="ag/carnot/workflow/runtime/Models.class" />
            <include name="ag/carnot/workflow/runtime/PasswordRules.class" />
            <include name="ag/carnot/workflow/runtime/Permission.class" />
            <include name="ag/carnot/workflow/runtime/PermissionState.class" />
            <include name="ag/carnot/workflow/runtime/RuntimePermissions.class" />
            <include name="ag/carnot/workflow/runtime/ProcessInstance.class" />
            <include name="ag/carnot/workflow/runtime/ProcessInstanceLinkType.class" />
            <include name="ag/carnot/workflow/runtime/ProcessInstancePriority.class" />
            <include name="ag/carnot/workflow/runtime/ProcessInstanceState.class" />
            <include name="ag/carnot/workflow/runtime/QueryService.class" />
            <include name="ag/carnot/workflow/runtime/ReconfigurationInfo.class" />
            <include name="ag/carnot/workflow/runtime/RepositoryMigrationJobInfo.class" />
            <include name="ag/carnot/workflow/runtime/RepositoryMigrationReport.class" />
            <include name="ag/carnot/workflow/runtime/RuntimeEnvironmentInfo.class" />
            <include name="ag/carnot/workflow/runtime/RuntimeObject.class" />
            <include name="ag/carnot/workflow/runtime/Scope.class" />
            <include name="ag/carnot/workflow/runtime/ServiceFactory.class" />
            <include name="ag/carnot/workflow/runtime/ServiceFactoryLocator.class" />
            <include name="ag/carnot/workflow/runtime/ServiceNotAvailableException.class" />
            <include name="ag/carnot/workflow/runtime/SubprocessSpawnInfo.class" />
            <include name="ag/carnot/workflow/runtime/User.class" />
            <include name="ag/carnot/workflow/runtime/UserExistsException.class" />
            <include name="ag/carnot/workflow/runtime/UserGroup.class" />
            <include name="ag/carnot/workflow/runtime/UserGroupExistsException.class" />
            <include name="ag/carnot/workflow/runtime/UserGroupInfo.class" />
            <include name="ag/carnot/workflow/runtime/UserInfo.class" />
            <include name="ag/carnot/workflow/runtime/UserRealm.class" />
            <include name="ag/carnot/workflow/runtime/UserService.class" />
            <include name="ag/carnot/workflow/runtime/WorkflowService.class" />

            <include name="ag/carnot/workflow/runtime/beans/AbortScope.class" />
            <include name="ag/carnot/workflow/runtime/beans/DocumentTypeUtils.class" />
            <include name="ag/carnot/workflow/runtime/beans/EmbeddedServiceFactory.class" />

            <include name="ag/carnot/workflow/runtime/details/ContextKind.class" />
            <include name="ag/carnot/workflow/runtime/details/HistoricalState.class" />
            <include name="ag/carnot/workflow/runtime/details/Note.class" />
            <include name="ag/carnot/workflow/runtime/details/ProcessInstanceAttributes.class" />
            <include name="ag/carnot/workflow/runtime/details/ProcessInstanceDetails.class" />
            <include name="ag/carnot/workflow/runtime/details/ProcessInstanceDetailsLevel.class" />
            <include name="ag/carnot/workflow/runtime/details/ProcessInstanceDetailsOptions.class" />
            <include name="ag/carnot/workflow/runtime/details/RuntimeEnvironmentInfoDetails.class" />
            <include name="ag/carnot/workflow/runtime/details/UserDetailsLevel.class" />

            <include name="ag/carnot/workflow/runtime/utils/ParticipantInfoUtil.class" />
            <include name="ag/carnot/workflow/runtime/utils/PermissionHelper.class" />
            <include name="ag/carnot/workflow/runtime/utils/ExecutionPermission.class" />

            <include name="ag/carnot/workflow/query/AbstractQueryResult.class" />
            <include name="ag/carnot/workflow/query/ActivityFilter.class" />
            <include name="ag/carnot/workflow/query/ActivityInstanceFilter.class" />
            <include name="ag/carnot/workflow/query/ActivityInstances.class" />
            <include name="ag/carnot/workflow/query/ActivityStateFilter.class" />
            <include name="ag/carnot/workflow/query/ActivityInstanceQuery.class" />
            <include name="ag/carnot/workflow/query/AttributeOrder.class" />
            <include name="ag/carnot/workflow/query/AttributedScopedFilter.class" />
            <include name="ag/carnot/workflow/query/BinaryOperatorFilter.class" />
            <include name="ag/carnot/workflow/query/CasePolicy.class" />
            <include name="ag/carnot/workflow/query/DataFilter.class" />
            <include name="ag/carnot/workflow/query/DataQuery.class" />
            <include name="ag/carnot/workflow/query/DataOrder.class" />
            <include name="ag/carnot/workflow/query/DeployedModelQuery.class" />
            <include name="ag/carnot/workflow/query/EvaluationPolicy.class" />
            <include name="ag/carnot/workflow/query/FilterAndTerm.class" />
            <include name="ag/carnot/workflow/query/FilterCriterion.class" />
            <include name="ag/carnot/workflow/query/FilterEvaluationVisitor.class" />
            <include name="ag/carnot/workflow/query/FilterOrTerm.class" />
            <include name="ag/carnot/workflow/query/FilterTerm.class" />
            <include name="ag/carnot/workflow/query/FilterVerifier.class" />
            <include name="ag/carnot/workflow/query/FilterableAttribute.class" />
            <include name="ag/carnot/workflow/query/HistoricalEventPolicy.class" />
            <include name="ag/carnot/workflow/query/HistoricalStatesPolicy.class" />
            <include name="ag/carnot/workflow/query/LinkDirection.class" />
            <include name="ag/carnot/workflow/query/LogEntryQuery.class" />
            <include name="ag/carnot/workflow/query/LogEntries.class" />
            <include name="ag/carnot/workflow/query/ModelVersionPolicy.class" />
            <include name="ag/carnot/workflow/query/OrderCriteria.class" />
            <include name="ag/carnot/workflow/query/OrderCriterion.class" />
            <include name="ag/carnot/workflow/query/OrderEvaluationVisitor.class" />
            <include name="ag/carnot/workflow/query/ParticipantAssociationFilter.class" />
            <include name="ag/carnot/workflow/query/ParticipantGrantFilter.class" />
            <include name="ag/carnot/workflow/query/ParticipantWorklist.class" />
            <include name="ag/carnot/workflow/query/PerformedByUserFilter.class" />
            <include name="ag/carnot/workflow/query/PerformingParticipantFilter.class" />
            <include name="ag/carnot/workflow/query/PerformingOnBehalfOfFilter.class" />
            <include name="ag/carnot/workflow/query/PerformingUserFilter.class" />
            <include name="ag/carnot/workflow/query/PreferenceQuery.class" />
            <include name="ag/carnot/workflow/query/ProcessDefinitionFilter.class" />
            <include name="ag/carnot/workflow/query/ProcessDefinitionQuery.class" />
            <include name="ag/carnot/workflow/query/ProcessInstanceDetailsPolicy.class" />
            <include name="ag/carnot/workflow/query/ProcessInstanceFilter.class" />
            <include name="ag/carnot/workflow/query/ProcessInstanceHierarchyFilter.class" />
            <include name="ag/carnot/workflow/query/ProcessInstanceQuery.class" />
            <include name="ag/carnot/workflow/query/ProcessInstances.class" />
            <include name="ag/carnot/workflow/query/ProcessStateFilter.class" />
            <include name="ag/carnot/workflow/query/Query.class" />
            <include name="ag/carnot/workflow/query/QueryResult.class" />
            <include name="ag/carnot/workflow/query/ScopedFilter.class" />
            <include name="ag/carnot/workflow/query/StartingUserFilter.class" />
            <include name="ag/carnot/workflow/query/SubsetPolicy.class" />
            <include name="ag/carnot/workflow/query/TernaryOperatorFilter.class" />
            <include name="ag/carnot/workflow/query/TimeoutPolicy.class" />
            <include name="ag/carnot/workflow/query/UnaryOperatorFilter.class" />
            <include name="ag/carnot/workflow/query/UnsupportedFilterException.class" />
            <include name="ag/carnot/workflow/query/UserGroupQuery.class" />
            <include name="ag/carnot/workflow/query/UserGroups.class" />
            <include name="ag/carnot/workflow/query/UserQuery.class" />
            <include name="ag/carnot/workflow/query/UserStateFilter.class" />
            <include name="ag/carnot/workflow/query/UserWorklist.class" />
            <include name="ag/carnot/workflow/query/Users.class" />
            <include name="ag/carnot/workflow/query/Worklist.class" />
            <include name="ag/carnot/workflow/query/WorklistQuery.class" />

            <include name="ag/carnot/workflow/spi/model/AccessPoint.class" />
            <include name="ag/carnot/workflow/spi/model/AccessPointProvider.class" />
            <include name="ag/carnot/workflow/spi/model/ApplicationContextValidator.class" />
            <include name="ag/carnot/workflow/spi/model/ApplicationValidator.class" />
            <include name="ag/carnot/workflow/spi/model/BridgeObject.class" />
            <include name="ag/carnot/workflow/spi/model/DataValidator.class" />
            <include name="ag/carnot/workflow/spi/model/gui/AccessPathEditor.class" />
            <include name="ag/carnot/workflow/spi/model/gui/ApplicationContextPropertiesPanel.class" />
            <include name="ag/carnot/workflow/spi/model/gui/ApplicationPropertiesPanel.class" />
            <include name="ag/carnot/workflow/spi/model/gui/DataPropertiesPanel.class" />
            <include name="ag/carnot/workflow/spi/model/gui/EventActionPropertiesPanel.class" />
            <include name="ag/carnot/workflow/spi/runtime/AccessPathEvaluator.class" />
            <include name="ag/carnot/workflow/spi/runtime/ApplicationInstance.class" />
            <include name="ag/carnot/workflow/spi/runtime/AsynchronousApplicationInstance.class" />
            <include name="ag/carnot/workflow/spi/runtime/Event.class" />
            <include name="ag/carnot/workflow/spi/runtime/EventActionInstance.class" />
            <include name="ag/carnot/workflow/spi/runtime/SynchronousApplicationInstance.class" />
            <include name="ag/carnot/workflow/spi/runtime/UnrecoverableExecutionException.class" />

            <include name="ag/carnot/workflow/spi/security/DynamicParticipantSynchronizationProvider.class" />
            <include name="ag/carnot/workflow/spi/security/DynamicParticipantSynchronizationStrategy.class" />
            <include name="ag/carnot/workflow/spi/security/ExternalDepartmentConfiguration.class" />
            <include name="ag/carnot/workflow/spi/security/ExternalLoginProvider.class" />
            <include name="ag/carnot/workflow/spi/security/ExternalLoginResult.class" />
            <include name="ag/carnot/workflow/spi/security/ExternalUserConfiguration.class" />
            <include name="ag/carnot/workflow/spi/security/ExternalUserGroupConfiguration.class" />
            <include name="ag/carnot/workflow/spi/security/LoginResult.class" />
            <include name="ag/carnot/workflow/spi/security/LoginProvider.class" />
            <include name="ag/carnot/workflow/spi/security/SynchronizationProvider.class" />
            <include name="ag/carnot/workflow/spi/security/SynchronizationStrategy.class" />

            <include name="ag/carnot/workflow/spi/security/TimebasedSynchronizationStrategy.class" />

            <include name="com/infinity/bpm/rt/integration/data/dms/DmsConstants.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/DmsDocumentBean.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/DmsPrincipal.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/DocumentType.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/DocumentAnnotations.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/Highlight.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/HighlightCapable.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/Identifiable.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/Note.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/NoteCapable.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/PageAnnotation.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/PageBookmark.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/PageBookmarkable.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/PageOrientation.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/PageOrientationAware.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/PageSequenceAware.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/PrintDocumentAnnotations.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/Stamp.class" />
            <include name="com/infinity/bpm/rt/integration/data/dms/annotations/printdocument/StampAware.class" />
            <include name="com/infinity/bpm/rt/monitoring/IProcessExecutionMonitor.class" />
            <include name="com/infinity/bpm/rt/monitoring/IWorklistMonitor.class" />
            <include name="com/infinity/bpm/rt/preferences/configurationvariables/ConfigurationVariable.class" />
            <include name="com/infinity/bpm/rt/preferences/configurationvariables/ConfigurationVariables.class" />
            <include name="com/infinity/bpm/rt/preferences/permissions/GlobalPermissionConstants.class" />
            <include name="com/infinity/bpm/rt/preferences/Preferences.class" />
            <include name="com/infinity/bpm/rt/preferences/PreferenceScope.class" />
            <include name="com/infinity/bpm/rt/preferences/IStaticConfigurationProvider.class" />

            <include name="com/infinity/bpm/ui/preferences/IStaticConfigurationProvider.class" />

            <include name="com/infinity/bpm/web/dms/DmsContentServlet.class" />
         </fileset>
      </ipp:jar>
      <copy todir="${build.lib}" file="${carnot.engine.jar}" />
   </target>

   <target name="jar.src" depends="compile">
      <ipp:jar jarfile="${carnot.base.src-jar}" excludes="*.jar" duplicate="preserve" implementationTitle="Infinity Process Engine - Base Sources">
         <fileset dir="${build.src.generated}">
            <include name="ag/carnot/autolist/**/*.java" />
            <include name="org/eclipse/stardust/common/**/*.java" />
            <include name="org/eclipse/stardust/common/config/**/*.java" />
            <include name="org/eclipse/stardust/common/error/**/*.java" />
            <include name="org/eclipse/stardust/common/reflect/**/*.java" />
            <include name="org/eclipse/stardust/common/security/**/*.java" />
            <include name="org/eclipse/stardust/common/utils/console/**/*.java" />
            <include name="org/eclipse/stardust/common/utils/ejb/*.java" />
            <include name="org/eclipse/stardust/common/utils/rt/*.java" />
            <include name="org/eclipse/stardust/common/utils/xml/**/*.java" />
            <!-- excluding due to questionable dependencies -->
            <exclude name="org/eclipse/stardust/common/security/authentication/GUICallbackHandler*.java" />
            <exclude name="org/eclipse/stardust/common/security/authentication/LoginDialog*.java" />
         </fileset>
         <fileset dir="${build.src.static}">
            <include name="ag/carnot/autolist/**/*.java" />
            <include name="org/eclipse/stardust/common/**/*.java" />
            <include name="org/eclipse/stardust/common/config/**/*.java" />
            <exclude name="org/eclipse/stardust/common/config/CurrentVersion.java" />
            <include name="org/eclipse/stardust/common/error/**/*.java" />
            <include name="org/eclipse/stardust/common/reflect/**/*.java" />
            <include name="org/eclipse/stardust/common/security/**/*.java" />
            <include name="org/eclipse/stardust/common/utils/console/**/*.java" />
            <include name="org/eclipse/stardust/common/utils/ejb/*.java" />
            <include name="org/eclipse/stardust/common/utils/rt/*.java" />
            <include name="org/eclipse/stardust/common/utils/xml/**/*.java" />
            <!-- excluding due to questionable dependencies -->
            <exclude name="org/eclipse/stardust/common/security/authentication/GUICallbackHandler*.java" />
            <exclude name="org/eclipse/stardust/common/security/authentication/LoginDialog*.java" />
         </fileset>
      </ipp:jar>
      <ipp:jar jarfile="${carnot.client.src-jar}" excludes="*.jar" duplicate="preserve" implementationTitle="Infinity Process Engine - Client Sources">
         <fileset dir="${build.src.generated}" excludes="*.jar" />
         <fileset dir="${build.src.static}" excludes="*.jar, org/eclipse/stardust/common/config/CurrentVersion.java" />
      </ipp:jar>
      <ipp:jar jarfile="${carnot.engine.src-jar}" excludes="*.jar" duplicate="preserve" implementationTitle="Infinity Process Engine - Runtime Sources">
         <fileset dir="${build.src.generated}" excludes="*.jar" />
         <fileset dir="${build.src.static}" excludes="*.jar, org/eclipse/stardust/common/config/CurrentVersion.java" />
      </ipp:jar>
      <ipp:jar jarfile="${carnot.emf.xsd.integration.src-jar}" excludes="*.jar" duplicate="preserve" implementationTitle="Infinity Process Engine - EMF XSD Integration Sources">
         <fileset dir="${build.src.generated}" excludes="*.jar">
            <include name="ag/carnot/bpm/rt/data/structured/emfxsd/**/*.*" />
         </fileset>
         <fileset dir="${build.src.static}" excludes="*.jar, org/eclipse/stardust/common/config/CurrentVersion.java">
            <include name="ag/carnot/bpm/rt/data/structured/emfxsd/**/*.*" />
         </fileset>
      </ipp:jar>
      <ipp:jar jarfile="${carnot.dms.src-jar}" implementationTitle="Infinity Process Engine - DMS Integration Sources">
         <fileset dir="${build.src.generated}" excludes="*.jar">
            <include name="ag/carnot/bpm/integration/dms/**/*.*" />
            <include name="ag/carnot/bpm/rt/integration/dms/**/*.*" />
         </fileset>
         <fileset dir="${build.src.static}" excludes="*.jar, org/eclipse/stardust/common/config/CurrentVersion.java">
            <include name="ag/carnot/bpm/integration/dms/**/*.*" />
            <include name="ag/carnot/bpm/rt/integration/dms/**/*.*" />
         </fileset>
      </ipp:jar>
   </target>

   <target name="deploy.src" depends="jar.src">
      <delete includeemptydirs="true">
         <fileset dir="${build.src}" excludes="*.jar" />
      </delete>
      <delete dir="${build.src.none}" />
   </target>

   <target name="deploy.classes" depends="jar">
      <delete dir="${build.classes}" />
   </target>

   <target name="compile" depends="prepareSources, initKernelBuildDirectories, initClasspath, compile.jdk15"
      description="compiles the carnot kernel classes" />

   <target name="compile.jdk15" depends="init"
      description="Compiling Java 1.5 code">

      <ipp:javac-java5
         srcdir="${build.src.generated}" sourcepath="${build.src.generated}:${build.src.static}"
         destdir="${build.classes}">

         <patternset refid="kernel.sources.exclude" />

         <classpath id="compile.classpath">
            <path path="${private.classpath}" />
            <path refid="carnot.classpath" />
            <path refid="secret.classpath" />
         </classpath>
      </ipp:javac-java5>

      <ipp:javac-java5
         srcdir="${build.src.static}" sourcepath="${build.src.generated}:${build.src.static}"
         destdir="${build.classes}">

         <exclude name="**/CurrentVersion.java" />

         <patternset refid="kernel.sources.exclude" />
         <classpath refid="compile.classpath" />

      </ipp:javac-java5>
   </target>

   <target name="prepareSources" depends="initKernelBuild, prepareSourcesExclusions, prepareSourcesForFastBuild, prepareSourcesForSafeBuild" />

   <target name="prepareSourcesExclusions">
      <patternset id="kernel.sources.exclude">
         <exclude name="org/eclipse/stardust/**/junit/**/*.java" />
         <exclude name="org/eclipse/stardust/**/test/**/*.java" />
         <exclude name="org/eclipse/stardust/**/TestPackage.java" />
         <exclude name="org/eclipse/stardust/**/autolist/console/*.java" />
         <exclude name="ag/carnot/**/web/*/**/*.java" />
         <exclude name="ag/carnot/**/wap/**/*.java" />
         <exclude name="ag/carnot/**/junit/**/*.java" />
         <exclude name="ag/carnot/**/test/**/*.java" />
         <exclude name="ag/carnot/**/TestPackage.java" />
         <exclude name="ag/carnot/**/autolist/console/*.java" />
      </patternset>
   </target>

   <target name="prepareSourcesForFastBuild" depends="initKernelBuildDirectories" if="build.fast">
      <echo message="Preparing sources for a fast but potentially unsafe build." />

      <property name="build.src.static" value="${project.src}" />
      <property name="build.src.generated" value="${build.src}" />

      <antcall target="copyVersionSourceFile">
         <param name="source" value="${project.src}" />
         <param name="destination" value="${build.src.generated}" />
      </antcall>
   </target>

   <target name="prepareSourcesForSafeBuild" depends="initKernelBuildDirectories" unless="build.fast">
      <echo message="Preparing sources for a safe but slow build." />

      <property name="build.src.static" value="${build.src.none}" />
      <property name="build.src.generated" value="${build.src}" />

      <mkdir dir="${build.src.generated}/ag/carnot" />
      <mkdir dir="${build.src.generated}/com/infinity" />

      <copy todir="${build.src.generated}">
         <fileset dir="${project.src}">
            <include name="**/*.java" />
            <include name="**/package.html" />
            <patternset refid="kernel.sources.exclude" />
            <exclude name="org/eclipse/stardust/common/config/CurrentVersion.java" />
         </fileset>
      </copy>

      <antcall target="copyVersionSourceFile">
         <param name="source" value="${project.src}" />
         <param name="destination" value="${build.src.generated}" />
      </antcall>
   </target>

   <target name="copyVersionSourceFile">
      <copy todir="${destination}">
         <fileset dir="${source}">
            <include name="org/eclipse/stardust/common/config/CurrentVersion.java" />
         </fileset>
         <filterset>
            <filter token="major" value="${version.major}" />
            <filter token="minor" value="${version.minor}" />
            <filter token="micro" value="${version.micro}" />
            <filter token="branch" value="${version.branch}" />
            <filter token="build" value="${version.build}" />
         </filterset>
      </copy>
   </target>

   <target name="copyDatFiles" depends="initKernelBuildDirectories">

      <mkdir dir="${build.classes}/META-INF/resources/models" />
      <copy todir="${build.classes}/META-INF/resources/models">
         <fileset dir="${project.res}/META-INF/resources/models" includes="*" />
      </copy>
      <mkdir dir="${build.classes}/META-INF/services" />
      <copy todir="${build.classes}/META-INF/services">
         <fileset dir="${project.res}/META-INF/services" includes="*" />
      </copy>

      <copy file="${project.res}/org/eclipse/stardust/engine/core/model/beans/WorkflowModel.dtd" todir="${build.classes}/org/eclipse/stardust/engine/core/model/beans" />
      <copy file="${project.res}/org/eclipse/stardust/engine/core/model/beans/WorkflowModel.xsd" todir="${build.classes}/org/eclipse/stardust/engine/core/model/beans" />

      <copy file="${project.res}/org/eclipse/stardust/engine/core/model/xpdl/carnot2xpdl.xslt" todir="${build.classes}/org/eclipse/stardust/engine/core/model/xpdl" />
      <copy file="${project.res}/org/eclipse/stardust/engine/core/model/xpdl/xpdl2carnot.xslt" todir="${build.classes}/org/eclipse/stardust/engine/core/model/xpdl" />
      <copy file="${project.res}/org/eclipse/stardust/engine/core/model/xpdl/TC-1025_schema_10_xpdl.xsd" todir="${build.classes}/org/eclipse/stardust/engine/core/model/xpdl" />
      <copy file="${project.res}/org/eclipse/stardust/engine/core/model/xpdl/carnot-xpdl.xsd" todir="${build.classes}/org/eclipse/stardust/engine/core/model/xpdl" />
      <copy file="${project.res}/org/eclipse/stardust/engine/core/model/xpdl/xpdl.xsd" todir="${build.classes}/org/eclipse/stardust/engine/core/model/xpdl" />

      <copy file="${project.res}/org/eclipse/stardust/engine/core/runtime/setup/carnot-runtime-setup.xsd" todir="${build.classes}/org/eclipse/stardust/engine/core/runtime/setup" />

      <copy file="${project.res}/org/eclipse/stardust/engine/core/upgrade/framework/WorkflowModel.dtd" todir="${build.classes}/org/eclipse/stardust/engine/core/upgrade/framework" />
	  <!--
      <copy file="${project.res}/com/infinity/bpm/rt/integration/webservices/dummyServices.wsdl" todir="${build.classes}/com/infinity/bpm/rt/integration/webservices" />
	  -->

   	  <copy todir="${build.classes}">
         <fileset dir="${project.res}" includes="org/eclipse/stardust/**" />
      </copy>

   	  <copy todir="${build.classes}/ag/carnot">
         <fileset dir="${project.res}/ag/carnot">
            <include name="**/*.gif" />
            <include name="workflow/spi/providers/applications/mail/*.properties" />
            <include name="**/images/*.css" />
            <include name="**/xslt/*.xsl" />
         </fileset>
      </copy>

      <copy todir="${build.classes}/com/infinity">
         <fileset dir="${project.res}/com/infinity">
            <include name="**/*.properties" />
            <include name="**/hazelcast.xml" />
         </fileset>
      </copy>

   </target>

   <target name="copyJars" depends="init, dependencies:publish-local" />

   <target name="init" depends="initOnDevelopment, initOnProduction" />

   <target name="initOnProduction" unless="setup.development">
      <echo message="Performing a production build ..." />

      <property name="javac.debuglevel" value="lines,source" />
   </target>

   <target name="initOnDevelopment" if="setup.development">
      <echo message="Performing a development build ..." />

      <property name="javac.debuglevel" value="lines,source,vars" />
   </target>

   <target name="initKernelBuild" depends="init">
      <property name="build.classes" location="${build.dir}/classes" />
      <property name="build.deploy" location="${build.dir}/lib" />
      <property name="build.lib" location="${build.dir}/lib" />
      <property name="build.src" location="${build.dir}/src" />
      <property name="build.src.none" location="${build.dir}/src-none" />

      <property name="carnot.base.jarfile" value="carnot-base.jar" />
      <property name="carnot.base.jar" location="${build.lib}/${carnot.base.jarfile}" />
      <property name="carnot.base.src-jarfile" value="carnot-base-src.jar" />
      <property name="carnot.base.src-jar" location="${build.src}/${carnot.base.src-jarfile}" />

      <property name="carnot.client.jarfile" value="carnot-client.jar" />
      <property name="carnot.client.jar" location="${build.lib}/${carnot.client.jarfile}" />
      <property name="carnot.client.src-jarfile" value="carnot-client-src.jar" />
      <property name="carnot.client.src-jar" location="${build.src}/${carnot.client.src-jarfile}" />

      <property name="carnot.engine.jarfile" value="carnot-engine.jar" />
      <property name="carnot.engine.jar" location="${build.deploy}/${carnot.engine.jarfile}" />
      <property name="carnot.engine.src-jarfile" value="carnot-engine-src.jar" />
      <property name="carnot.engine.src-jar" location="${build.src}/${carnot.engine.src-jarfile}" />

      <property name="carnot.emf.xsd.integration.jarfile" value="carnot-emf-xsd-integration.jar" />
      <property name="carnot.emf.xsd.integration.jar" location="${build.deploy}/${carnot.emf.xsd.integration.jarfile}" />
      <property name="carnot.emf.xsd.integration.src-jarfile" value="carnot-emf-xsd-integration-src.jar" />
      <property name="carnot.emf.xsd.integration.src-jar" location="${build.src}/${carnot.emf.xsd.integration.src-jarfile}" />


      <property name="carnot.dms.jarfile" value="carnot-dms.jar" />
      <property name="carnot.dms.jar" location="${build.lib}/${carnot.dms.jarfile}" />
      <property name="carnot.dms.src-jarfile" value="carnot-dms-src.jar" />
      <property name="carnot.dms.src-jar" location="${build.src}/${carnot.dms.src-jarfile}" />


      <property name="carnot.public.jarfile" value="carnot-public.jar" />
      <property name="carnot.public.jar" location="${build.lib}/${carnot.public.jarfile}" />
      <property name="carnot.public.src-jarfile" value="carnot-public-src.jar" />
      <property name="carnot.public.src-jar" location="${build.src}/${carnot.public.src-jarfile}" />

   </target>

   <import file="build-dependencies-${dependencies.mode}.xml" />

   <target name="initClasspath" depends="init, dependencies:initClasspath" />

   <target name="publish" depends="init, dependencies:publish" />

   <target name="initKernelBuildDirectories" depends="initKernelBuild">
      <mkdir dir="${build.classes}" />
      <mkdir dir="${build.deploy}" />
      <mkdir dir="${build.lib}" />
      <mkdir dir="${build.src}" />
      <mkdir dir="${build.src.none}" />
   </target>

   <target name="init.jarjar">
      <ipp:init-jarjar classpathref="jarjar.classpath" />
   </target>

   <!--                                  -->
   <!--   Test Targets                   -->
   <!--                                  -->

   <target name="runTests" depends="compileTests" description="runs the Infinity tests">
      <!-- Classpath For JUnit Tests -->
      <path id="run.junit.test.classpath">
         <path refid="junit.test.classpath" />
         <path refid="junit.test.license.classpath" />
         <path refid="run.test.classpath" />
         <pathelement location="${build.tests.classes}" />
         <pathelement location="${build.tests.etc}" />
         <!-- Service Provider mechanism needs JAR although the classpath is already set to ${build.classes} -->
         <pathelement location="${build.lib}/carnot-engine.jar" />
      </path>

      <!-- Sanity Test Suite -->
      <junit fork="yes" haltonfailure="on" haltonerror="on">
         <test name="org.eclipse.stardust.engine.SanityTestSuite" />
         <formatter type="brief" usefile="false" />
         <classpath refid="run.junit.test.classpath" />
      </junit>

      <!-- Application Instance Test Suite -->
      <junit fork="yes" haltonfailure="on" haltonerror="on">
         <test name="org.eclipse.stardust.engine.extensions.ApplicationInstanceTestSuite" />
         <formatter type="brief" usefile="false" />
         <classpath refid="run.junit.test.classpath" />
      </junit>
   </target>

   <target name="compileTests" depends="compile, copyTestsSourceFiles, copyTestsDatFiles, initClasspath" description="compiles the Infinity test classes">
      <javac srcdir="${build.tests.src}" destdir="${build.tests.classes}" debug="true" deprecation="no" includes="**/*.java">
         <classpath refid="junit.test.classpath" />
         <classpath refid="junit.test.license.classpath" />
      </javac>
   </target>

   <target name="copyTestsSourceFiles" depends="initTestsBuildDirectories">
      <mkdir dir="${build.tests.src}/org/eclipse/stardust" />
      <copy todir="${build.tests.src}/org/eclipse/stardust">
         <fileset dir="${project.test.src}/org/eclipse/stardust">
            <include name="**/*.java" />
         </fileset>
      </copy>
   </target>

   <target name="initTestsBuildDirectories" depends="initTestBuild">
      <mkdir dir="${build.tests}" />
      <mkdir dir="${build.tests.classes}" />
      <mkdir dir="${build.tests.etc}" />
      <mkdir dir="${build.tests.lib}" />
      <mkdir dir="${build.tests.src}" />
   </target>

   <target name="initTestBuild" depends="initTestsBuildDirProperties, initTestsArchiveProperties">
      <path id="junit.test.classpath">
         <path refid="carnot.classpath" />
         <path refid="secret.classpath" />
         <path refid="jta.classpath" />
         <path refid="jms.classpath" />
         <path refid="test.classpath" />
         <pathelement path="${build.classes}" />
      </path>
      <path id="junit.test.license.classpath">
         <pathelement path="${build.dir}/license/classes" />
      </path>
   </target>

   <target name="initTestsBuildDirProperties" depends="init">
      <property name="build.tests" value="${build.dir}/tests" />
      <property name="build.tests.bin" value="${build.tests}/bin" />
      <property name="build.tests.classes" value="${build.tests}/classes" />
      <property name="build.tests.etc" value="${build.tests}/etc" />
      <property name="build.tests.lib" value="${build.tests}/lib" />
      <property name="build.tests.src" value="${build.tests}/src" />
   </target>

   <target name="copyTestsDatFiles" depends="initTestsBuildDirectories">
      <copy todir="${build.tests.etc}">
         <fileset dir="${project.test.res}">
            <include name="META-INF/**/*" />
            <include name="**/*.properties" />
            <include name="**/*.xml" />
            <include name="**/*.xsd" />
         </fileset>
      </copy>
   </target>

   <target name="initTestsArchiveProperties">
      <property name="carnot.tests.jarfile" value="carnot-tests.jar" />
      <property name="carnot.tests.jar" value="${build.tests.lib}/${carnot.tests.jarfile}" />

      <property name="carnot.jdbcproxy.jarfile" value="carnot-jdbc-proxy.jar" />
      <property name="carnot.jdbcproxy.jar" value="${build.tests.lib}/${carnot.jdbcproxy.jarfile}" />
   </target>

   <target name="initCodeGenTest">
      <mkdir dir="${build.dir}/temp/ag/carnot/workflow/ejb/beans/" />
      <mkdir dir="${build.dir}/temp/ag/carnot/workflow/ejb/tunneling/beans/" />
      <property name="buildtest.dir" value="${build.dir}/temp" />
   </target>

   <target name="runCodeGenTest" depends="initCodeGenTest"
      description="runs CodeGen to create Testfiles for comparing">
      <java classname="org.eclipse.stardust.engine.api.ejb2.tools.CodeGen" fork="yes">
         <classpath>
            <pathelement path="${build.classes}" />
            <pathelement location="${qdox.jar}" />
         </classpath>
         <arg line="${project.src} ${build.dir}/temp" />
      </java>
   </target>

   <target name="compareFiles" description="compares serviceFile with created tempFile">
      <condition property="codegen.build">
         <filesmatch file1="${service.dir}/${serviceName}" file2="${serviceTemp.dir}/${serviceName}" />
      </condition>
      <!--fail unless="codegen.build"
           message="Error: CodeGen-File ${service.dir}/${serviceName} is not up to date!"/-->
      <echo message="CodeGen-File ${service.dir}/${serviceName} is up to date!" />
   </target>

   <target name="checkCodeGen" depends="runCodeGenTest"
      description="checks if CodeGen-Files are updated">

      <!-- no tunneling -->

      <antcall target="compareFiles">
         <param name="serviceName" value="RemoteWorkflowService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="RemoteUserService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="RemoteAdministrationService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="RemoteQueryService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="RemoteDocumentManagementService.java" />
      </antcall>

      <antcall target="compareFiles">
         <param name="serviceName" value="LocalWorkflowService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="LocalUserService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="LocalAdministrationService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="LocalQueryService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="LocalDocumentManagementService.java" />
      </antcall>

      <antcall target="compareFiles">
         <param name="serviceName" value="beans/RemoteWorkflowServiceImpl.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="beans/RemoteUserServiceImpl.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="beans/RemoteAdministrationServiceImpl.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="beans/RemoteQueryServiceImpl.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="beans/RemoteDocumentManagementServiceImpl.java" />
      </antcall>

      <!-- tunneling -->

      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingRemoteWorkflowService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingRemoteUserService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingRemoteAdministrationService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingRemoteQueryService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingRemoteDocumentManagementService.java" />
      </antcall>

      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingLocalWorkflowService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingLocalUserService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingLocalAdministrationService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingLocalQueryService.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/TunnelingLocalDocumentManagementService.java" />
      </antcall>

      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/beans/TunnelingWorkflowServiceImpl.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/beans/TunnelingUserServiceImpl.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/beans/TunnelingAdministrationServiceImpl.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/beans/TunnelingQueryServiceImpl.java" />
      </antcall>
      <antcall target="compareFiles">
         <param name="serviceName" value="tunneling/beans/TunnelingDocumentManagementServiceImpl.java" />
      </antcall>

      <delete dir="${build.dir}/temp" />
   </target>

   <!--
   #
   # Compound targets
   #
   -->

   <target name="build" depends="copyDatFiles, jar, copyJars"
      description="make a usable version of the kernel" />

   <target name="deploy" depends="build, deploy.src, deploy.classes"
      description="makes a deployable version of the kernel" />

   <target name="clean" depends="init" description="removes all build results">
      <delete dir="${build.dir}" />
   </target>

   <target name="dist" depends="build, jar.src" if="moonglow.dir.present">
      <copy file="${carnot.base.jar}" todir="${moonglow.dir}/../stardust/ide/engine/org.eclipse.stardust.ide.engine.base/lib" />
      <copy file="${carnot.base.src-jar}" todir="${moonglow.dir}/../stardust/ide/engine/org.eclipse.stardust.ide.engine.base/lib" />
      <copy file="${carnot.engine.jar}" todir="${moonglow.dir}/../stardust/ide/engine/org.eclipse.stardust.ide.engine.core/lib" />
      <copy file="${carnot.engine.src-jar}" todir="${moonglow.dir}/../stardust/ide/engine/org.eclipse.stardust.ide.engine.core/lib" />
      <copy file="${carnot.emf.xsd.integration.jar}" todir="${moonglow.dir}/../stardust/ide/engine/org.eclipse.stardust.ide.engine.core/lib" />
      <copy file="${carnot.emf.xsd.integration.src-jar}" todir="${moonglow.dir}/../stardust/ide/engine/org.eclipse.stardust.ide.engine.core/lib" />
      <copy file="${carnot.dms.jar}" todir="${moonglow.dir}/../stardust/ide.wst/org.eclipse.stardust.ide.wst.facet.portal/lib" />
      <copy file="${carnot.dms.jar}" todir="${moonglow.dir}/../stardust/ide/modeling/org.eclipse.stardust.modeling.integration.dms/lib" />
   </target>
</project>
